<div class="modal-container">
  <button
    mat-icon-button
    class="close-btn"
    (click)="dialogRef.close()"
    aria-label="Chiudi"
  >
    <mat-icon>close</mat-icon>
  </button>
  <h2>
    <span class="value">{{ getDesGiornataTitle(data.giornata) }}</span>
  </h2>

  <!-- INFO COMPATTA ELEGANTE -->
  <div class="info-compact">
    <span class="info-item">
      <span class="label">ðŸ‘¤</span>
      <span class="value">{{ giocatore.nome }}</span>
    </span>
    <span class="info-separator">|</span>
    <span class="info-item">
      <mat-icon class="stato-icon">{{ getGiocaIcon() }}</mat-icon>
      <span class="value">{{ data.statoGiornataCorrente.descrizione }}</span>
    </span>
  </div>

  @if(squadreDisponibili.length > 0) {
  <!-- SELEZIONE SQUADRE -->
  <div class="calendario-container">
    <h3 class="calendario-title">
      Seleziona squadra
      @if(searchQuery && squadreFiltrate.length > 0) {
        <span class="team-count">({{ squadreFiltrate.length }})</span>
      }
    </h3>

    <!-- BARRA DI RICERCA -->
    <div class="search-container">
      <mat-icon class="search-icon">search</mat-icon>
      <input
        type="text"
        class="search-input"
        [placeholder]="getSearchPlaceholder()"
        [(ngModel)]="searchQuery"
        (input)="filtraSquadre()"
      />
      @if(searchQuery) {
        <button class="clear-search" (click)="clearSearch()">
          <mat-icon>close</mat-icon>
        </button>
      }
    </div>

    @if(squadreFiltrate.length === 0) {
      <div class="no-results">
        <mat-icon>search_off</mat-icon>
        <p>Nessuna squadra trovata</p>
      </div>
    } @else {
      <div class="squadre-grid">
        @for (squadra of squadreFiltrate; track squadra.sigla) {
      <div
        class="squadra-card"
        [class.selected]="squadraSelezionata === squadra.sigla"
        [style.background]="squadraSelezionata === squadra.sigla
          ? 'linear-gradient(135deg, ' + getTeamColors(squadra.sigla).primary + ', ' + getTeamColors(squadra.sigla).secondary + ')'
          : 'linear-gradient(135deg, ' + getTeamColors(squadra.sigla).primary + '08, ' + getTeamColors(squadra.sigla).secondary + '12)'"
        [style.borderColor]="getTeamColors(squadra.sigla).primary"
        (click)="selezionaSquadra(squadra.sigla)"
      >
        <div class="squadra-icon"
             [style.background]="squadraSelezionata === squadra.sigla ? '#FFFFFF' : getTeamColors(squadra.sigla).primary"
             [style.borderColor]="squadraSelezionata === squadra.sigla ? '#FFFFFF' : getTeamColors(squadra.sigla).secondary"
             [style.color]="squadraSelezionata === squadra.sigla ? getTeamColors(squadra.sigla).primary : '#FFFFFF'">
          {{ getSquadraInitials(squadra.nome) }}
        </div>
        <div class="squadra-info">
          <span class="squadra-nome" [style.color]="squadraSelezionata === squadra.sigla ? '#FFFFFF' : '#0A3D91'">{{ formatNomeSquadra(squadra.nome) }}</span>
          @if(squadra.prossimaPartita) {
          <span class="vs-text" [style.color]="squadraSelezionata === squadra.sigla ? 'rgba(255,255,255,0.85)' : '#9CA3AF'">vs {{ formatNomeSquadra(getAvversarioNome(squadra.prossimaPartita, squadra.sigla)) }}</span>
          }
        </div>
        <mat-icon class="check-icon">check</mat-icon>
      </div>
      }
    </div>
    }
  </div>

  <!-- AZIONI: CONFERMA + DETTAGLI -->
  <div class="actions-container">
    <div class="save-container">
      <button
        mat-raised-button
        class="save-button"
        (click)="salvaSquadra()"
        [disabled]="!squadraSelezionata"
      >
        <mat-icon>check</mat-icon>
        <span>Conferma</span>
      </button>
    </div>

    @if(squadraSelezionata) {
    <button
      class="details-button"
      [style.borderColor]="getTeamColors(squadraSelezionata).primary"
      [style.color]="getTeamColors(squadraSelezionata).primary"
      (click)="toggleDettagli()"
    >
      <mat-icon>analytics</mat-icon>
      <span>Dettagli</span>
    </button>
    }
  </div>

  } @else {
    <h4 style="text-align: center; color: #6B7280;">Purtroppo non hai giocate disponibili</h4>
  }
</div>
