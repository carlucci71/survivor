<div class="modal-container">
  <button
    mat-icon-button
    class="close-btn"
    (click)="dialogRef.close()"
    aria-label="Chiudi"
  >
    <mat-icon>close</mat-icon>
  </button>
  <h2>Seleziona giocata</h2>
  <div class="info-row">
    <span class="label">Giocatore:</span>
    <span class="value">{{ giocatore.nome }}</span>
  </div>
  <div class="info-row">
    <span class="label">Giornata:</span>
    <span class="value">{{ getDesGiornataTitle(data.giornata) }}</span>
  </div>
  <div class="info-row">
    <span class="label">Stato:</span>
    <span class="value">{{ data.statoGiornataCorrente.descrizione }}</span>
  </div>

  <div class="squadra-select-save">
    <mat-form-field appearance="outline" class="select-squadra">
      <mat-select
        placeholder="Seleziona squadra"
        [(ngModel)]="squadraSelezionata"
        (selectionChange)="mostraUltimiRisultati(); mostraProssimePartite()"
        [ngModelOptions]="{ standalone: true }"
      >
        @for (squadra of squadreDisponibili; track squadra.sigla) {
        <mat-option [value]="squadra.sigla">{{ squadra.nome }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
    <button
      mat-raised-button
      color="primary"
      (click)="salvaSquadra()"
      [disabled]="!squadraSelezionata"
    >
      Salva
    </button>
    <span class="next-opponent" *ngIf="getNextOpponentSigla(false)">vs {{ getNextOpponentSigla(false) }}</span>
  </div>

  <div class="risultati-row">
    <div class="risultati-col" role="region" aria-label="Ultimi risultati">
      <h3 class="risultati-title">Ultimi Risultati</h3>
      @if (squadraSelezionata && ultimiRisultati.length === 0) {
      <div>Nessun risultato recente</div>
      } @for (risultato of ultimiRisultati; track risultato.giornata) {
      <div class="risultato-item">
        <div>
          [{{ getDesGiornata(risultato,risultato.casaSigla === squadraSelezionata) }}]
          {{ risultato.orario | date : "yyyy/MM/dd" }}
        </div>
        <div>
          <span
            [class.selected-team]="risultato.casaSigla === squadraSelezionata"
            >{{ risultato.casaNome }}</span
          >
          -
          <span
            [class.selected-team]="risultato.fuoriSigla === squadraSelezionata"
            >{{ risultato.fuoriNome }}</span
          >
          <span>
            {{ risultato.scoreCasa }}
          </span>
          -
          <span>
            {{ risultato.scoreFuori }}
          </span>
          <span class="result-badge">
            @if (squadraSelezionata === risultato.casaSigla) { 
              @if (risultato.scoreCasa > risultato.scoreFuori) {
            <span class="badge badge-v">V</span>
              } 
              @if (risultato.scoreCasa === risultato.scoreFuori) {
            <span class="badge badge-n">N</span>
              } 
              @if (risultato.scoreCasa < risultato.scoreFuori) {
            <span class="badge badge-p">P</span>
              } 
            } 
            @if (squadraSelezionata === risultato.fuoriSigla) {
              @if (risultato.scoreFuori > risultato.scoreCasa) {
            <span
              class="badge badge-v"
              >V</span
            >
              }
              @if (risultato.scoreFuori === risultato.scoreCasa) {
            <span
              class="badge badge-n"
              >N</span
            >
              }
              @if (risultato.scoreFuori < risultato.scoreCasa) {
            <span
              class="badge badge-p"
              >P</span
            >
              }
            }
          </span>
        </div>
        @if (risultato.stato && risultato.stato.value !== StatoPartita.TERMINATA.value) {
          <span>{{ risultato.stato.value }}</span>
        }
      </div>
      }
    </div>

    <div class="risultati-col" role="region" aria-label="Prossime partite">
      <h3 class="risultati-title">Prossime partite</h3>
       @if (squadraSelezionata && prossimePartite.length === 0) {
      <div>Nessuna partita in programma</div>
      } @for (risultato of prossimePartite; track risultato.giornata) {
      <div class="risultato-item">
        <div>
          [{{ getDesGiornata(risultato,risultato.casaSigla === squadraSelezionata) }}]
          {{ risultato.orario | date : "yyyy/MM/dd" }}
        </div>
        <div>
          <span
            [class.selected-team]="risultato.casaSigla === squadraSelezionata"
            >{{ risultato.casaNome }}</span
          >
          -
          <span
            [class.selected-team]="risultato.fuoriSigla === squadraSelezionata"
            >{{ risultato.fuoriNome }}</span
          >
        </div>
      </div>
      }
    </div>

    <div class="risultati-col" role="region" [attr.aria-label]="'Ultimi risultati ' + (getNextOpponentSigla(false) || '')">
      <h3 class="risultati-title">Ultimi Risultati {{getNextOpponentSigla(false)}}</h3>
      @if (squadraSelezionata && ultimiRisultatiOpponent.length === 0) {
      <div>Nessun risultato recente per {{getNextOpponentSigla(false)}}</div>
      }
      @for (risultato of ultimiRisultatiOpponent; track risultato.giornata) {
      <div class="risultato-item">
        <div>
          [{{ getDesGiornata(risultato,risultato.casaSigla === getNextOpponentSigla(true)) }}]
        {{ risultato.orario | date : "yyyy/MM/dd" }}
        </div>
        <div>

          <span
            [class.selected-team]="risultato.casaSigla === getNextOpponentSigla(true)"
            >{{ risultato.casaNome }}</span
          >
          -
          <span
            [class.selected-team]="risultato.fuoriSigla === getNextOpponentSigla(true)"
            >{{ risultato.fuoriNome }}</span
          >


        </div>
        <div>
        {{ risultato.scoreCasa }} - {{ risultato.scoreFuori }}
        <span class="result-badge">
          @if (getNextOpponentSigla(true) === risultato.casaSigla) {
            @if (risultato.scoreCasa > risultato.scoreFuori) {
            <span class="badge badge-v">V</span>
            }
            @if (risultato.scoreCasa === risultato.scoreFuori) {
            <span class="badge badge-n">N</span>
            }
            @if (risultato.scoreCasa < risultato.scoreFuori) {
            <span class="badge badge-p">P</span>
            }
          }
          @if (getNextOpponentSigla(true) === risultato.fuoriSigla) {
            @if (risultato.scoreFuori > risultato.scoreCasa) {
            <span class="badge badge-v">V</span>
            }
            @if (risultato.scoreFuori === risultato.scoreCasa) {
            <span class="badge badge-n">N</span>
            }
            @if (risultato.scoreFuori < risultato.scoreCasa) {
            <span class="badge badge-p">P</span>
            }
          }
        </span>
        </div>
      </div>
      }
    </div>
