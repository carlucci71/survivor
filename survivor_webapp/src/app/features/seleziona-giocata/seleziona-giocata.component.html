<div class="modal-container">
  <button
    mat-icon-button
    class="close-btn"
    (click)="dialogRef.close()"
    [attr.aria-label]="'COMMON.CLOSE' | translate"
  >
    <mat-icon>close</mat-icon>
  </button>
  <h2>
    <span class="value">{{ getDesGiornataTitle(data.giornata) }}</span>
  </h2>

  <!-- INFO COMPATTA ELEGANTE -->
  <div class="info-compact">
    <span class="info-item">
      <span class="label">ðŸ‘¤</span>
      <span class="value">{{ giocatore.nome }}</span>
    </span>
    <span class="info-separator">|</span>
    <span class="info-item">
      <mat-icon class="stato-icon">{{ getGiocaIcon() }}</mat-icon>
      <span class="value">{{ data.statoGiornataCorrente.descrizione }}</span>
    </span>
  </div>

  @if(squadreDisponibili.length > 0) {
  <!-- SELEZIONE SQUADRE -->
  <div class="calendario-container">
    <h3 class="calendario-title">
      {{ 'PLAY.SELECT_TEAM' | translate }}
      @if(searchQuery && squadreFiltrate.length > 0) {
        <span class="team-count">({{ squadreFiltrate.length }})</span>
      }
    </h3>

    <!-- BARRA DI RICERCA -->
    <div class="search-container">
      <mat-icon class="search-icon">search</mat-icon>
      <input
        type="text"
        class="search-input"
        [placeholder]="getSearchPlaceholder()"
        [(ngModel)]="searchQuery"
        (input)="filtraSquadre()"
      />
      @if(searchQuery) {
        <button class="clear-search" (click)="clearSearch()">
          <mat-icon>close</mat-icon>
        </button>
      }
    </div>

    @if(squadreFiltrate.length === 0) {
      <div class="no-results">
        <mat-icon>search_off</mat-icon>
        <p>{{ 'PLAY.NO_TEAMS_FOUND' | translate }}</p>
      </div>
    } @else {
      <!-- SCROLL ORIZZONTALE CON CARD LOGHI -->
      <div class="teams-scroll-container">
        <!-- Freccia sinistra -->
        <button
          class="scroll-arrow scroll-arrow-left"
          (click)="scrollLeft()"
          [class.hidden]="!canScrollLeft"
        >
          <mat-icon>chevron_left</mat-icon>
        </button>

        <!-- Freccia destra -->
        <button
          class="scroll-arrow scroll-arrow-right"
          (click)="scrollRight()"
          [class.hidden]="!canScrollRight"
        >
          <mat-icon>chevron_right</mat-icon>
        </button>

        <div class="teams-scroll-wrapper" #scrollWrapper (wheel)="onScrollWrapperScroll($event)" (scroll)="updateScrollButtons()">
          @for (squadra of squadreFiltrate; track squadra.sigla) {
            <div
              class="jersey-card"
              [class.selected]="squadraSelezionata === squadra.sigla"
              (click)="selezionaSquadra(squadra.sigla)"
            >
              <!-- LOGO O FALLBACK -->
              <div class="jersey-container" [class.tennis-container]="lega.campionato?.sport?.id === 'TENNIS'">
                @if(lega.campionato?.sport?.id === 'TENNIS') {
                  <!-- TENNIS: Foto giocatore circolare -->
                  <div class="tennis-photo-wrapper">
                    <img
                      [src]="getTeamLogo(squadra.sigla)!"
                      [alt]="formatNomeSquadra(squadra.nome)"
                      class="tennis-photo"
                      (error)="onLogoError($event)"
                    />
                  </div>
                } @else {
                  <!-- CALCIO/BASKET: Logo o maglietta -->
                  @if(getTeamLogo(squadra.sigla)) {
                    <!-- Logo ufficiale -->
                    <img
                      [src]="getTeamLogo(squadra.sigla)!"
                      [alt]="formatNomeSquadra(squadra.nome)"
                      class="team-logo-img"
                      (error)="onLogoError($event)"
                    />
                    <!-- Fallback SVG -->
                    <svg class="jersey-svg" style="display: none;" viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
                      <path class="jersey-body" [attr.fill]="getTeamColors(squadra.sigla).primary" d="M 20 25 L 10 35 L 10 50 L 15 50 L 15 120 L 85 120 L 85 50 L 90 50 L 90 35 L 80 25 L 75 20 Q 70 15 65 15 L 60 20 Q 55 25 50 25 Q 45 25 40 20 L 35 15 Q 30 15 25 20 L 20 25 Z"/>
                      <path class="jersey-stripe" [attr.fill]="getTeamColors(squadra.sigla).secondary" opacity="0.3" d="M 35 30 L 65 30 L 65 50 L 35 50 Z"/>
                      <text class="jersey-number" x="50" y="75" text-anchor="middle" [attr.fill]="getTeamColors(squadra.sigla).secondary" font-size="32" font-weight="bold" font-family="'Poppins', sans-serif">{{ getSquadraInitials(squadra.nome) }}</text>
                    </svg>
                  } @else {
                    <!-- SVG Maglietta fallback -->
                    <svg class="jersey-svg" viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
                      <path class="jersey-body" [attr.fill]="getTeamColors(squadra.sigla).primary" d="M 20 25 L 10 35 L 10 50 L 15 50 L 15 120 L 85 120 L 85 50 L 90 50 L 90 35 L 80 25 L 75 20 Q 70 15 65 15 L 60 20 Q 55 25 50 25 Q 45 25 40 20 L 35 15 Q 30 15 25 20 L 20 25 Z"/>
                      <path class="jersey-stripe" [attr.fill]="getTeamColors(squadra.sigla).secondary" opacity="0.3" d="M 35 30 L 65 30 L 65 50 L 35 50 Z"/>
                      <text class="jersey-number" x="50" y="75" text-anchor="middle" [attr.fill]="getTeamColors(squadra.sigla).secondary" font-size="32" font-weight="bold" font-family="'Poppins', sans-serif">{{ getSquadraInitials(squadra.nome) }}</text>
                    </svg>
                  }
                }
              </div>

              <!-- INFO SQUADRA -->
              <div class="jersey-info">
                <span class="jersey-name">{{ formatNomeSquadra(squadra.nome) }}</span>
                @if(squadra.prossimaPartita) {
                  <span class="jersey-vs">vs {{ formatNomeSquadra(getAvversarioNome(squadra.prossimaPartita, squadra.sigla)) }}</span>
                }
              </div>

              <!-- CHECK ICON -->
              @if(squadraSelezionata === squadra.sigla) {
                <div class="jersey-check">
                  <mat-icon>check_circle</mat-icon>
                </div>
              }
            </div>
          }
        </div>
      </div>
    }
  </div>

  <!-- AZIONI: CONFERMA + STATISTICHE -->
  <div class="actions-container">
    <!-- TOGGLE PRIVACY GIOCATA - SOLO ICONA OCCHIO -->
    <div class="privacy-checkbox-container">
      <div class="privacy-toggle-wrapper">
        <button
          type="button"
          class="privacy-toggle"
          (click)="giocataPubblica = !giocataPubblica"
        >
          <mat-icon class="privacy-icon">
            {{ giocataPubblica ? 'visibility' : 'visibility_off' }}
          </mat-icon>
          <span class="privacy-label-text">
            {{ giocataPubblica ? 'Rendi invisibile la mia giocata' : 'Rendi visibile la mia giocata' }}
          </span>
        </button>
      </div>
    </div>

    <div class="save-container">
      <button
        mat-raised-button
        class="save-button"
        (click)="salvaSquadra()"
        [disabled]="!squadraSelezionata"
      >
        <mat-icon>check</mat-icon>
        <span>{{ 'COMMON.CONFIRM' | translate }}</span>
      </button>
    </div>

    @if(squadraSelezionata) {
    <button
      class="details-button"
      [style.borderColor]="getTeamColors(squadraSelezionata).primary"
      [style.color]="getTeamColors(squadraSelezionata).primary"
      (click)="toggleDettagli()"
    >
      <mat-icon>analytics</mat-icon>
      <span>{{ 'PLAY.STATISTICS' | translate }}</span>
    </button>
    }
  </div>

  } @else {
    <h4 style="text-align: center; color: #6B7280;">{{ 'PLAY.NO_PLAYS_AVAILABLE' | translate }}</h4>
  }
</div>
