<div class="modal-container">
  <button
    mat-icon-button
    class="close-btn"
    (click)="dialogRef.close()"
    aria-label="Chiudi"
  >
    <mat-icon>close</mat-icon>
  </button>
  <h2>
    <span class="value">{{
      getDesGiornataTitle(data.giornata + lega.giornataIniziale - 1)
    }}</span>
  </h2>
  <div class="info-row">
    <span class="label">Giocatore:</span>
    <span class="value">{{ giocatore.nome }}</span>
  </div>
  <div class="info-row">
    <span class="label">Stato:</span>
    <span class="value-with-icon">
      <span class="value">{{ data.statoGiornataCorrente.descrizione }}</span>
      <mat-icon class="stato-icon">{{ getGiocaIcon() }}</mat-icon>
    </span>
  </div>

  <!-- Tabs to switch between result sections (mobile-friendly) -->
  <!-- Tabs moved below the 'vs' next-opponent span per user request -->

  @if(squadreDisponibili.length>0){
  <div class="squadra-select-save">
    <mat-form-field #selectField appearance="outline" class="select-squadra">
      <mat-select
        #teamSelect
        placeholder="Seleziona squadra"
        [(ngModel)]="squadraSelezionata"
        (selectionChange)="mostraUltimiRisultati(); mostraProssimePartite()"
        [ngModelOptions]="{ standalone: true }"
      >
        @for (squadra of squadreDisponibili; track squadra.sigla) {
        <mat-option [value]="squadra.sigla">{{ squadra.nome }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
    <button
      mat-raised-button
      color="primary"
      class="save-small"
      (click)="salvaSquadra()"
      [disabled]="!squadraSelezionata"
    >
      Salva
    </button>
    <span class="next-opponent" *ngIf="getNextOpponentSigla(false)"
      >vs {{ getNextOpponentSigla(false) }}</span
    >
    <!-- Tabs accordion: chiusi di default, apertura al click -->
    <div class="result-tabs" *ngIf="ultimiRisultati.length || prossimePartite.length || ultimiRisultatiOpponent.length">
      <button class="tab" [class.active]="activeTab === 'ultimi'" (click)="setActiveTab('ultimi')">Ultimi Risultati</button>
      <button class="tab" [class.active]="activeTab === 'prossime'" (click)="setActiveTab('prossime')">Prossimi Incontri</button>
      <button class="tab" [class.active]="activeTab === 'opponent'" (click)="setActiveTab('opponent')">Risultati {{getNextOpponentSigla(false)}}</button>
    </div>
  </div>
  <div class="risultati-row" #risultatiRow>
    <!-- On desktop show all three columns side-by-side; on mobile show only the active tab column -->
    <div *ngIf="!isMobile || activeTab === 'ultimi'" class="risultati-col" role="region" aria-label="Ultimi risultati">
      <h3 class="risultati-title" [class.hidden-when-tabs]="!(ultimiRisultati.length||prossimePartite.length||ultimiRisultatiOpponent.length)">Ultimi Risultati</h3>
      @if (squadraSelezionata && ultimiRisultati.length === 0) {
      <div>Nessun risultato recente</div>
      } @for (risultato of ultimiRisultati; track risultato.giornata) {
      <div class="risultato-item">
        <div>
          [{{
            getDesGiornata(
              risultato,
              risultato.casaSigla === squadraSelezionata
            )
          }}]
          {{ risultato.orario | date : "yyyy/MM/dd" }}
        </div>
        <div>
          <span
            [class.selected-team]="risultato.casaSigla === squadraSelezionata"
            >{{ risultato.casaNome }}</span
          >
          -
          <span
            [class.selected-team]="risultato.fuoriSigla === squadraSelezionata"
            >{{ risultato.fuoriNome }}</span
          >
          <span>
            {{ risultato.scoreCasa }}
          </span>
          -
          <span>
            {{ risultato.scoreFuori }}
          </span>
          <span class="result-badge">
            @if (squadraSelezionata === risultato.casaSigla) { @if
            (risultato.scoreCasa > risultato.scoreFuori) {
            <span class="badge badge-v">V</span>
            } @if (risultato.scoreCasa === risultato.scoreFuori) {
            <span class="badge badge-n">N</span>
            } @if (risultato.scoreCasa < risultato.scoreFuori) {
            <span class="badge badge-p">P</span>
            } } @if (squadraSelezionata === risultato.fuoriSigla) { @if
            (risultato.scoreFuori > risultato.scoreCasa) {
            <span class="badge badge-v">V</span>
            } @if (risultato.scoreFuori === risultato.scoreCasa) {
            <span class="badge badge-n">N</span>
            } @if (risultato.scoreFuori < risultato.scoreCasa) {
            <span class="badge badge-p">P</span>
            } }
          </span>
        </div>
        @if (risultato.stato && risultato.stato.value !==
        StatoPartita.TERMINATA.value) {
        <span>{{ risultato.stato.value }}</span>
        }
      </div>
      }
    </div>

    <div *ngIf="activeTab === 'prossime'" class="risultati-col active" role="region" aria-label="Prossime partite">
      <h3 class="risultati-title" [class.hidden-when-tabs]="!(ultimiRisultati.length||prossimePartite.length||ultimiRisultatiOpponent.length)">Prossime partite</h3>
      @if (squadraSelezionata && prossimePartite.length === 0) {
      <div>Nessuna partita in programma</div>
      } @for (risultato of prossimePartite; track risultato.giornata) {
      <div class="risultato-item">
        <div>
          [{{
            getDesGiornata(
              risultato,
              risultato.casaSigla === squadraSelezionata
            )
          }}]
          {{ risultato.orario | date : "yyyy/MM/dd" }}
        </div>
        <div>
          <span
            [class.selected-team]="risultato.casaSigla === squadraSelezionata"
            >{{ risultato.casaNome }}</span
          >
          -
          <span
            [class.selected-team]="risultato.fuoriSigla === squadraSelezionata"
            >{{ risultato.fuoriNome }}</span
          >
        </div>
      </div>
      }
    </div>

    <div *ngIf="activeTab === 'opponent'" class="risultati-col active" role="region" [attr.aria-label]="'Ultimi risultati ' + (getNextOpponentSigla(false) || '')">
      <h3 class="risultati-title" [class.hidden-when-tabs]="!(ultimiRisultati.length||prossimePartite.length||ultimiRisultatiOpponent.length)">Ultimi Risultati {{ getNextOpponentSigla(false) }}</h3>
      @if (squadraSelezionata && ultimiRisultatiOpponent.length === 0) {
      <div>Nessun risultato recente per {{ getNextOpponentSigla(false) }}</div>
      } @for (risultato of ultimiRisultatiOpponent; track risultato.giornata) {
      <div class="risultato-item">
        <div>
          [{{
            getDesGiornata(
              risultato,
              risultato.casaSigla === getNextOpponentSigla(true)
            )
          }}]
          {{ risultato.orario | date : "yyyy/MM/dd" }}
        </div>
        <div>
          <span
            [class.selected-team]="
              risultato.casaSigla === getNextOpponentSigla(true)
            "
            >{{ risultato.casaNome }}</span
          >
          -
          <span
            [class.selected-team]="
              risultato.fuoriSigla === getNextOpponentSigla(true)
            "
            >{{ risultato.fuoriNome }}</span
          >
        </div>
        <div>
          {{ risultato.scoreCasa }} - {{ risultato.scoreFuori }}
          <span class="result-badge">
            @if (getNextOpponentSigla(true) === risultato.casaSigla) { @if
            (risultato.scoreCasa > risultato.scoreFuori) {
            <span class="badge badge-v">V</span>
            } @if (risultato.scoreCasa === risultato.scoreFuori) {
            <span class="badge badge-n">N</span>
            } @if (risultato.scoreCasa < risultato.scoreFuori) {
            <span class="badge badge-p">P</span>
            } } @if (getNextOpponentSigla(true) === risultato.fuoriSigla) { @if
            (risultato.scoreFuori > risultato.scoreCasa) {
            <span class="badge badge-v">V</span>
            } @if (risultato.scoreFuori === risultato.scoreCasa) {
            <span class="badge badge-n">N</span>
            } @if (risultato.scoreFuori < risultato.scoreCasa) {
            <span class="badge badge-p">P</span>
            } }
          </span>
        </div>
      </div>
      }
    </div>
  </div>
  }@else {
    <h4>Purtroppo non hai giocate disponibili</h4>
  }
</div>
