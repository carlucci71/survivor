<div class="player-history-dialog">
  <div class="dialog-header">
    <div class="header-content">
      <mat-icon class="player-icon">person</mat-icon>
      <div class="player-info">
        <h2 class="player-name">{{ data.giocatore.nickname }}</h2>
        <p class="dialog-subtitle">{{ 'LEAGUE.FULL_HISTORY' | translate }}</p>
      </div>
    </div>
    <button mat-icon-button class="close-btn" (click)="close()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <div class="dialog-content">
    <!-- Layout Desktop: Due righe (5 squadre per riga) -->
    <div class="history-rows-layout desktop-only">
      <!-- Prima riga: prime 5 giornate -->
      <div class="history-row">
        @for (giornata of getFirstRowRounds(); track giornata) {
          @let giocata = getGiocataForRound(giornata);
          <div class="history-item"
               [class.item-ok]="giocata?.esito === 'OK'"
               [class.item-ko]="giocata?.esito === 'KO'"
               [class.item-pending]="!giocata?.esito">

            <div class="item-header">
              <span class="round-number">{{ getGiornataLabel(giornata) }}</span>
              @if(giocata?.esito) {
                <mat-icon class="result-icon-small" [class.icon-ok]="giocata.esito === 'OK'" [class.icon-ko]="giocata.esito === 'KO'">
                  {{ giocata.esito === 'OK' ? 'check_circle' : 'cancel' }}
                </mat-icon>
              }
            </div>

            <div class="item-body">
              @if(giocata?.squadraSigla) {
                <div class="team-display">
                  @if(getTeamLogo(giocata.squadraSigla)) {
                    <img [src]="getTeamLogo(giocata.squadraSigla)!"
                         [alt]="getSquadraNome(giocata.squadraSigla) || giocata.squadraSigla"
                         class="team-logo-inline"
                         (error)="$any($event.target).style.display='none'">
                  }
                  @if(giocata.forzatura) {
                    <mat-icon class="forced-badge" [matTooltip]="'LEAGUE.FORCED_BY_ADMIN' | translate">
                      edit
                    </mat-icon>
                  }
                </div>
              } @else {
                <div class="empty-slot">
                  <mat-icon>remove</mat-icon>
                </div>
              }
            </div>
          </div>
        }
      </div>

      <!-- Seconda riga: giornate dalla 6 alla 10 (se presenti) -->
      @if(getSecondRowRounds().length > 0) {
        <div class="history-row">
          @for (giornata of getSecondRowRounds(); track giornata) {
            @let giocata = getGiocataForRound(giornata);
            <div class="history-item"
                 [class.item-ok]="giocata?.esito === 'OK'"
                 [class.item-ko]="giocata?.esito === 'KO'"
                 [class.item-pending]="!giocata?.esito">

              <div class="item-header">
                <span class="round-number">{{ getGiornataLabel(giornata) }}</span>
                @if(giocata?.esito) {
                  <mat-icon class="result-icon-small" [class.icon-ok]="giocata.esito === 'OK'" [class.icon-ko]="giocata.esito === 'KO'">
                    {{ giocata.esito === 'OK' ? 'check_circle' : 'cancel' }}
                  </mat-icon>
                }
              </div>

              <div class="item-body">
                @if(giocata?.squadraSigla) {
                  <div class="team-display">
                    @if(getTeamLogo(giocata.squadraSigla)) {
                      <img [src]="getTeamLogo(giocata.squadraSigla)!"
                           [alt]="getSquadraNome(giocata.squadraSigla) || giocata.squadraSigla"
                           class="team-logo-inline"
                           (error)="$any($event.target).style.display='none'">
                    }
                    @if(giocata.forzatura) {
                      <mat-icon class="forced-badge" [matTooltip]="'LEAGUE.FORCED_BY_ADMIN' | translate">
                        edit
                      </mat-icon>
                    }
                  </div>
                } @else {
                  <div class="empty-slot">
                    <mat-icon>remove</mat-icon>
                  </div>
                }
              </div>
            </div>
          }
        </div>
      }
    </div>

    <!-- Layout Mobile: Due righe (5 squadre per riga) - UGUALE a desktop ma con dimensioni ottimizzate -->
    <div class="history-rows-layout mobile-only">
      <!-- Prima riga: prime 5 giornate -->
      <div class="history-row">
        @for (giornata of getFirstRowRounds(); track giornata) {
          @let giocata = getGiocataForRound(giornata);
          <div class="history-item"
               [class.item-ok]="giocata?.esito === 'OK'"
               [class.item-ko]="giocata?.esito === 'KO'"
               [class.item-pending]="!giocata?.esito">

            <div class="item-header">
              <span class="round-number">{{ getGiornataLabel(giornata) }}</span>
              @if(giocata?.esito) {
                <mat-icon class="result-icon-small" [class.icon-ok]="giocata.esito === 'OK'" [class.icon-ko]="giocata.esito === 'KO'">
                  {{ giocata.esito === 'OK' ? 'check_circle' : 'cancel' }}
                </mat-icon>
              }
            </div>

            <div class="item-body">
              @if(giocata?.squadraSigla) {
                <div class="team-display">
                  @if(getTeamLogo(giocata.squadraSigla)) {
                    <img [src]="getTeamLogo(giocata.squadraSigla)!"
                         [alt]="getSquadraNome(giocata.squadraSigla) || giocata.squadraSigla"
                         class="team-logo-inline"
                         (error)="$any($event.target).style.display='none'">
                  }
                  @if(giocata.forzatura) {
                    <mat-icon class="forced-badge" [matTooltip]="'LEAGUE.FORCED_BY_ADMIN' | translate">
                      edit
                    </mat-icon>
                  }
                </div>
              } @else {
                <div class="empty-slot">
                  <mat-icon>remove</mat-icon>
                </div>
              }
            </div>
          </div>
        }
      </div>

      <!-- Seconda riga: giornate dalla 6 alla 10 (se presenti) -->
      @if(getSecondRowRounds().length > 0) {
        <div class="history-row">
          @for (giornata of getSecondRowRounds(); track giornata) {
            @let giocata = getGiocataForRound(giornata);
            <div class="history-item"
                 [class.item-ok]="giocata?.esito === 'OK'"
                 [class.item-ko]="giocata?.esito === 'KO'"
                 [class.item-pending]="!giocata?.esito">

              <div class="item-header">
                <span class="round-number">{{ getGiornataLabel(giornata) }}</span>
                @if(giocata?.esito) {
                  <mat-icon class="result-icon-small" [class.icon-ok]="giocata.esito === 'OK'" [class.icon-ko]="giocata.esito === 'KO'">
                    {{ giocata.esito === 'OK' ? 'check_circle' : 'cancel' }}
                  </mat-icon>
                }
              </div>

              <div class="item-body">
                @if(giocata?.squadraSigla) {
                  <div class="team-display">
                    @if(getTeamLogo(giocata.squadraSigla)) {
                      <img [src]="getTeamLogo(giocata.squadraSigla)!"
                           [alt]="getSquadraNome(giocata.squadraSigla) || giocata.squadraSigla"
                           class="team-logo-inline"
                           (error)="$any($event.target).style.display='none'">
                    }
                    @if(giocata.forzatura) {
                      <mat-icon class="forced-badge" [matTooltip]="'LEAGUE.FORCED_BY_ADMIN' | translate">
                        edit
                      </mat-icon>
                    }
                  </div>
                } @else {
                  <div class="empty-slot">
                    <mat-icon>remove</mat-icon>
                  </div>
                }
              </div>
            </div>
          }
        </div>
      }
    </div>
  </div>

  <div class="dialog-footer">
    <button mat-raised-button color="primary" (click)="close()">
      {{ 'COMMON.CLOSE' | translate }}
    </button>
  </div>
</div>

